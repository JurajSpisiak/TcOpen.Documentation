<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>State | TcOpen </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="State | TcOpen ">
    <meta name="generator" content="docfx 2.58.9.0">
    
    <link rel="shortcut icon" href="../../../favicon.png">
    <link rel="stylesheet" href="../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../styles/main.css">
    <meta property="docfx:navrel" content="../../../toc">
    <meta property="docfx:tocrel" content="../../toc">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../index.html">
                <p class="text-logo">TcOpen</p>
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
                
                <ul class="nav level1 navbar-nav">
                      <li>
                          <a href="../../../articles/intro.html" title="Articles">Articles</a>
                      </li>
                      <li>
                          <a href="../../../api/index.html" title="API reference">API reference</a>
                      </li>
                </ul>    </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div>
              <div class="sidefilter">
                <form class="toc-filter">
                  <span class="glyphicon glyphicon-filter filter-icon"></span>
                  <input type="text" id="toc_filter_input" placeholder="Enter here to filter..." onkeypress="if(event.keyCode==13) {return false;}">
                </form>
              </div>
              <div class="sidetoc">
                <div class="toc" id="toc">
                  
                  <ul class="nav level1">
                    <li class="">
                      <a href="../../intro.html" title="Introduction" class="">Introduction</a>
                    </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Conventions</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../../Conventions/Conventions.html" title="General" class="">General</a>
                          </li>
                          <li class="">
                            <a href="../../Conventions/Component.html" title="Components" class="">Components</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">TcOpen Framework</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <span class="expand-stub"></span>
                            <a class="">TcoCore</a>
                              
                              <ul class="nav level3">
                                <li class="">
                                  <a href="../../TcOpenFramework/TcoCore/Introduction.html" title="Introduction" class="">Introduction</a>
                                </li>
                                <li class="">
                                  <a href="../../TcOpenFramework/TcoCore/TcoContext.html" title="TcoContext" class="">TcoContext</a>
                                </li>
                                <li class="">
                                  <a href="../../TcOpenFramework/TcoCore/TcoObject.html" title="TcoObject" class="">TcoObject</a>
                                </li>
                                <li class="">
                                  <a href="../../TcOpenFramework/TcoCore/TcoTask.html" title="TcoTask" class="">TcoTask</a>
                                </li>
                                <li class="">
                                  <a href="../../TcOpenFramework/TcoCore/TcoComponent.html" title="TcoComponent" class="">TcoComponent</a>
                                </li>
                                <li class="">
                                  <a href="../../TcOpenFramework/TcoCore/TcoMessenger.html" title="TcoMessenger" class="">TcoMessenger</a>
                                </li>
                                <li class="">
                                  <a href="../../TcOpenFramework/TcoCore/TcoLogger.html" title="TcoLogger" class="">TcoLogger</a>
                                </li>
                              </ul>  </li>
                          <li class="">
                            <span class="expand-stub"></span>
                            <a class="">TcoData</a>
                              
                              <ul class="nav level3">
                                <li class="">
                                  <a href="../../TcOpenFramework/TcoData/Introduction.html" title="Introduction" class="">Introduction</a>
                                </li>
                              </ul>  </li>
                          <li class="">
                            <span class="expand-stub"></span>
                            <a class="">Howto(s)</a>
                              
                              <ul class="nav level3">
                                <li class="">
                                  <a href="../../TcOpenFramework/howtos/How_to_get_started_using_tcopen_libraries/article.html" title="How to get started using TcOpen libraries" class="">How to get started using TcOpen libraries</a>
                                </li>
                                <li class="">
                                  <a href="../../TcOpenFramework/howtos/How_to_write_a_sequence/article.html" title="How to write a sequence" class="">How to write a sequence</a>
                                </li>
                                <li class="">
                                  <a href="../../TcOpenFramework/howtos/How_to_include_tcopen_in_a_project/article.html" title="How to include TcOpen in a project" class="">How to include TcOpen in a project</a>
                                </li>
                              </ul>  </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">TcOpen Inxton</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../../Inxton/Colors_wpf.html" title="Colors Material Design WPF" class="">Colors Material Design WPF</a>
                          </li>
                          <li class="">
                            <a href="../../Inxton/InxtonConventions.html" title="Inxton Conventions" class="">Inxton Conventions</a>
                          </li>
                          <li class="">
                            <span class="expand-stub"></span>
                            <a class="">Inxton.Vortex.Framework.Blazor</a>
                              
                              <ul class="nav level3">
                                <li class="">
                                  <a href="../../Inxton/Inxton_vortex_framework_blazor/Inxton_vortex_framework_blazor.html" title="Introduction and installing" class="">Introduction and installing</a>
                                </li>
                                <li class="">
                                  <a href="../../Inxton/Inxton_vortex_framework_blazor/Renderablecontentcontrol.html" title="RenderableContentControl" class="">RenderableContentControl</a>
                                </li>
                                <li class="">
                                  <a href="../../Inxton/Inxton_vortex_framework_blazor/Layouts.html" title="Layouts" class="">Layouts</a>
                                </li>
                                <li class="">
                                  <a href="../../Inxton/Inxton_vortex_framework_blazor/Custom_libraries.html" title="Custom libraries" class="">Custom libraries</a>
                                </li>
                                <li class="">
                                  <a href="../../Inxton/Inxton_vortex_framework_blazor/Security.html" title="Security" class="">Security</a>
                                </li>
                              </ul>  </li>
                        </ul>  </li>
                  </ul>        </div>
              </div>
            </div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="state">State</h1>

<p><strong>(TcoState : ITcoState)</strong></p>
<p><a href="../../../api/TcoCore/PlcDocu.TcoCore.TcoStateBase.html">API</a></p>
<p>The state controller <code>TcoState</code> manages states of the system.</p>
<p><code>TcoState</code> holds the control variable and manages the change via <code>TcoState.ChangeState(newState)</code>.</p>
<p>The override of the <code>TcoState.OnStateChange(lastState, newState)</code> method allows to perform operation on transition between the states.</p>
<pre><code class="lang-iecst">IF(State = 10) THEN
    IF(a.DoSomething().Done) THEN
        ChangeState(20).Restore(VerticalCylinder).Restore(HorizontalCylinder);  // Change state and restore objects
    END_IF;    
END_IF;    

IF(s.State = 20) THEN
    IF(VerticalCylinder.DoSomething().Done) THEN
        ChangeState(10);    
    END_IF;    
END_IF;    

//--------------------------------------------------
// Override of OnStateChange method
//--------------------------------------------------
METHOD PROTECTED OnStateChange
VAR_INPUT
	PreviousState	: INT;
	NewState 		: INT;
END_VAR

// On transition to state 10
IF(NewState = 10) THEN
    logger.Log('Transitioning to state no 10');
    VerticalCylinder.Restore();
END_IF;    
</code></pre>
<h4 id="restoring-state-of-objects">Restoring state of objects</h4>
<p>The restorable objects alleviate the burden of finding the right place and time for restoring objects in the PLC program.</p>
<p>Any object that implements correctly <code>ITcoRestorable</code> is eligible for implicit auto-restore. <code>ITcoRestorable.Restore()</code> method must implement the logic that brings the object to the initial state <code>Ready</code> and thus make it ready for the new execution.</p>
<p>We already mentioned restoring mechanisms in the section about <code>ITcoTask</code>. The example above demonstrates two ways of performing <strong>explicit</strong> the auto restore:</p>
<ol>
<li>In the state <code>10</code> call</li>
</ol>
<pre><code>s.ChangeState(20).Restore(VerticalCylinder).Restore(HorizontalCylinder)
</code></pre>
<p>restores the state of the object <code>VerticalCylinder</code> and <code>HorizontalCylinder</code>;</p>
<ol start="2">
<li>In the override <code>OnStateChange</code>, we restore only object <code>VerticalCylinder</code>.</li>
</ol>
<p><strong>Implicit</strong> restoring mechanism restores object without explicit coding. There are two ways the object can be restored:</p>
<ol>
<li><p>The objects that are <strong>directly declared</strong> in the body of the object of <code>ITcoState</code> will be restored when</p>
<ol>
<li>The <code>ITcoState</code> changes state,</li>
<li><code>ITcoState</code> is configured auto-restorable,</li>
<li><code>IRestorable</code> object is a direct member of the <code>ITcoState</code>.</li>
</ol>
</li>
</ol>
<p>In this case, the state of the child objects (<code>ITcoObject</code> declared directly in the state block) is restored when the state of the parent <code>ITcoState</code> changes.</p>
<pre><code class="lang-iecst">//---------------------------------------------------------
FUNCTION_BLOCK MyContext EXTENDS TcoCore.TcoContext
VAR
    // AutoRestoreMembers INDICATES THE STATES MEMBERS ARE AUTO-RESTORABLE
    _myState : MyStateController(THIS^, eRestoreMode.AutoRestoreMembers); 
END_VAR   
//---------------------------------------------------------
FUNCTION_BLOCK MyStateController : EXTENDS TcoCore.TcoState
VAR
    VerticalCylinder : MyComponentThasDoesSomething(THIS^);
END_VAR;    

IF(State = 10) THEN
    IF(VerticalCylinder.DoSomething().Done) THEN
        ChangeState(20); 
    END_IF;    
END_IF;    

IF(s.State = 20) THEN
    IF(VerticalCylinder.DoSomething().Done) THEN
        ChangeState(10);    
    END_IF;    
END_IF;    
</code></pre>
<ol start="2">
<li>The classes that implement the auto-restorable mechanism (<code>TcoTask</code>) will restore its state upon the call of the method executing an action, provided that there were at least two consecutive cycles of the context where that executing method was not called.</li>
</ol>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/TcOpenGroup/TcOpen.Documentation/blob/dev/articles/TcOpenFramework/TcoCore/TcoState.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <p>Generated by <strong>DocFX</strong> | Delivered by TcOpenGroup contributors</p>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../styles/main.js"></script>
  </body>
</html>
